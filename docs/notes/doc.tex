\documentclass[10pt,a4paper]{report}
 \usepackage{booktabs}
\usepackage{float}
\usepackage{tabularx}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}


\usepackage{polski}
\usepackage[polish]{babel}
\usepackage[utf8]{inputenc}
\usepackage[polish]{babel}

\usepackage{indentfirst}
\usepackage{ifthen}
\usepackage{hyperref}
\hypersetup{
	colorlinks=true, %set true if you want colored links
	linktoc=all,     %set to all if you want both sections and subsections linked
	linkcolor=red,  %choose some color if you want links to stand out
}

\usepackage{tikz}
\def\checkmark{\tikz\fill[scale=0.4](0,.35) -- (.25,0) -- (1,.7) -- (.25,.15) -- cycle;} 
\usepackage{color, colortbl}

\usepackage[americancurrents]{circuitikz}

\usetikzlibrary{shapes,arrows,calc}

\tikzstyle{block} = [rectangle, draw, text width=5cm, 
text centered, rounded corners, 
minimum height=2cm, node distance=2cm]

\tikzstyle{line} = [draw, -latex']

\usepackage{geometry}
\geometry{legalpaper, margin=1in}

\newcommand{\img}[4]{
	\begin{figure}[H]
		\begin{center}
			\includegraphics[width=#1 cm, keepaspectratio=true]{#2}
			\caption{#3}
			\label{#4}
		\end{center}
	\end{figure}
}

\definecolor{Gray}{gray}{0.9}
\setcounter{secnumdepth}{4}

\title{Notatki do pracy inżynierskiej. \\ 8-bitowy przetwornik cyfrowo analogowy w technologii CMOS. \\ STAN : alpha}
\date{2018}
\author{Michał Czyż \\ student, WETI PG}

\begin{document}
	\maketitle
	
	\tableofcontents
	\newpage
	\chapter{Preliminaria.}
	\section{Abstract.}
	{	Goal of this thesis... \textcolor{red}{NA KONIEC UZUPEŁNIĆ.} }

	\section{Abstrakt.}
	{	Celem niniejszej pracy jest zaprojektowanie schematu i topografii masek 8-bitowego przetwornika cyfrowo analogowego w technologii CMOS AMS 180nm. \textcolor{red}{NA KONIEC UZUPEŁNIĆ.} }
	
	\section{Podziękowania.}
	{	Dziękujemy wszystkim ... . \textcolor{red}{NA KONIEC UZUPEŁNIĆ} }
	
	\chapter{Wstęp.}
	{	Konwertery sygnałów z postaci cyfrowej na analogową (i odwrotnie) są niezbędną częścią systemów elektronicznych, ponieważ umożliwiają komunikację pomiędzy zewnętrznym, analogowym światem i cyfrowymi rdzeniami układów krzemowych \cite{integconv}. Do przykładowych zastosowań konwerterów należą m.in. generowanie sygnału wizyjnego, fonicznego lub sygnałów sterowania np. dla układów radarowych czy konwerterów mocy. }
	
	{	Sygnałem wejściowym dla N bitowego przetwornika cyfrowo analogowego jest słowo cyfrowe \\ $\mathcal{B}=\{b_{N-1},b_{N-2},...,b_0\}$. Bit $b_{N-1}$ nosi miano najstarszego bitu (MSB - Most Siginificant Bit), a bit $b_0$ to najmłodszy (LSB - Least Siginificant Bit). Sygnał wyjściowy to analogowe napięcie lub prąd $\mathcal{S}$ przeskalowany przez sygnał referencyjny $V_{ref}$. Zależność pomiędzy sygnałem wyjściowym i wejściowym to wtedy:
	\begin{equation}
	\mathcal{S} = V_{ref}\mathcal{B} = V_{ref} {\sum_{k=0}^{N-1} b_k2^k}
	\end{equation}

	}
	
	\section{Architektury konwerterów C/A. \cite{cmosanal} \cite{plassche}}
	{	Dokonuje się kilku podziałów konwerterów. Ze względu na liczbę przetwarzanych bitów wyróżnia się: \textbf{szeregowe}, czyli takie, które dokonują konwersji słowa cyfrowego bit po bicie oraz \textbf{równoległe}, czyli takie, które dokonują konwersji całego słowa jednocześnie. Jeżeli sygnał wyjściowy przetwornika jest stały w czasie dla ustalonego i podtrzymywanego słowa cyfrowego, to nazywamy taki przetwornik \textbf{statycznym}, w przeciwieństwie do przetworników \textbf{dynamicznych}, których sygnał wyjściowy zanika i wymaga odświeżania. }
	
	{	\textbf{Przetwornik z modulacją szerokości impulsów} dokonuje porównania słowa cyfrowego z liniowo rosnącym cyfrowym słowem odniesienia. Wygenerowany w ten sposób impuls o szerokości zależnej od wartości przetwarzanego słowa poddawany jest filtracji dolnoprzepustowej. Do wad tego rozwiązania należą mała szybkośc przetwarzania i konieczność stosowania filtów o wysokim tłumieniu w paśmie zaporowym. }
	
	{	\textbf{Przetwornik integracyjny z całkowaniem liniowym} również wykorzystuje mechanizm porównywania liczb cyfrowych do wygenerowania sygnału o modulowanej szerkości, który jest poddawany scałkowaniu, a następnie spróbkowaniu przez układ próbkująco pamiętający. Celem zwiększenia szybkości działania układu dokonuje się podzielenia słowa bitowego na część starszą i młodszą, a przetwarzanie obu części odbywa się równolegle. }
	
	{	\textbf{Przetworniki sieciowe ze skalowaniem} dokonują zamiany słowa cyfrowego na napięcia, prądy lub ładunki proporcjonalne (ważone) do wartości tego słowa. Sygnały z poszczególnych gałęzi sieci są sumowane, a sygnał wyjściowy podlega konwersji i/lub kondycjonowaniu do zadanej formy. Udaje się uzyskać rozdzielczość do 10-bitów.}
	
	{	\textbf{Przetwornik z kształtowaniem szumu} wykorzystuje filtry nadpróbkujące, układy kształtowania szumu, 1-bitowy przetwornik C/A i analogowy filtr wyjściowy. Uzyskuje się wysoką precyzję 16-18 bitów. }
	
	{	\textbf{Przetwornik szeregowy z redystrybucją ładunku} wykorzystuje układ dwóch połączonych równolegle identycznych kondensatorów i kilka kluczy. Kondensator wejściowy jest ładowany lub rozładowywany w zależności od wartości kolejnych bitów, a następnie dołączany do kondensatora wyjściowego, co pozwala na dodanie lub odjęcie ładunku, a więc zwiększenie lub zmniejszenie wartości napięcia wyjściowego.
	}
	
	{	\textbf{Przetwornik algorytmiczny potokowy} składa się z sumatorów i bloków opóźnienia, które pozwalają na dodawanie przeskalowanych napięć referencyjnych w kolejnych blokach. \textcolor{red}{przepisać} }

	{	\textbf{Przetwornik algorytmiczny iteracyjny} w weźle układu próbkująco pamiętającego dodaje kolejne bity. \textcolor{red}{przepisać} }

	{ 	\textbf{Przetworniki segmentowe} to przetworniki składające się z połączenia dwóch lub więcej przetworników. Zazwyczaj łączone są przetowrniki o małej liczbie bitów w większe, aby zwiększyć rozdzielczość. }

	\section{Parametry statyczne przetworników C/A.(\textcolor{red}{Podać tylko te parametry, które będę mierzył.})}
	{	\textbf{Zakres sygnału wyjściowego $FS$} to zakres wartości, które może przyjmować sygnał wyjściowy przetwornika.
		$$
		V_{out} \in \langle V_{out_{min}} ;  V_{out_{max}} \rangle
		$$
		
		$$
		FS = V_{out_{max}} - V_{out_{min}}
		$$	
	}
	
	{	\textbf{Rozdzielczość } określa minimalną zmianę sygnału wyjściowego dla kolejnych słów cyfrowych. Odpowiada stosunkowi pełnego zakresu napięcia wyjściowego do liczby poziomów (różnych słów cyfrowych).
		$$
		
		$$
	}

	{	\textbf{Dokładność względna} to odchylenie wartości sygnału wyjściowego w stanie ustalonym od teoretycznej prostej wyznaczonej przez pełny zakres przetwarzania. }

	{	Sygnał wyjściowy przetwornika \textbf{monotonicznego} nie zmniejsza się dla wzrostu wejściowego słowa cyfrowego. }

	{	\textbf{Przesunięcie zera} to wartość sygnału wyjściowego dla sygnału wejściowego o wartości zero. }

	{ 	\textbf{Nieliniowość całkowa INL} to wartość bezwzględna sumy błędów nieliniowości dodatnich (lub ujemnych).}
	
	{ 	\textbf{Nieliniowość różniczkowa DNL} to zmiana sygnału wyjściowego w stosunku do LSB przy przejściu o jedno słowo cyfrowe obliczone dla każdego przejścia osobno. }

	\section{Parametry dynamiczne przetworników C/A.}
	{ \textbf{\textcolor{red}{Wymienić resztę.}}
	}

	{
		\begin{itemize}
			\item Stosunek sygnału do szumu.
			\item Maksymalna częstotliwośc próbkowania,
			\item PSRR.
		\end{itemize} 
	}

	\chapter{Technologia AMS 180nm.}
	
	\section{Dostępne urządzenia.}
	{	W projekcie wykorzystano następujące tranzystory dostarczone przez producenta technologii:
		\begin{itemize}
			\item NFET,
			\item NFETX,
			\item PFET,
			\item PFETX,
%			\item NFETVTH,
%			\item NFETVTHX,
%			\item PFETVTH,
%			\item PFETVTHX.
		\end{itemize}
   }
	\section{Model tranzystora LV-FET z kanałem indukowanym do obliczeń ręcznych.}
	{ 	W pracy wykorzystywane są niskonapięciowe tranzystory polowe z kanałami indukowanymi typu n i p. Do obliczęń ręcznych wykorzystano uproszczony model kwadratowy. Wyróżnia się w nim obszary pracy tranzystora: odcięcia, triodowy (inaczej: nienasycenia, omowy), pentodowy (nasycenia). }
	
	{	Obszar odcięcia tranzystora NFET:
		\begin{equation}
			V_{GS} \leq V_{TH,n}
		\end{equation}
		
		\begin{equation}
			I_{DS} \eqsim 0
		\end{equation}
	}
	
	{	Obszar nienasycenia tranzystora NFET:
		\begin{equation}
			V_{GS} > V_{TH,n}
		\end{equation}
		
		\begin{equation}
			V_{DS} \leq V_{GS} - V_{TH,n}
		\end{equation}
		
		\begin{equation}
			I_{DS} = \mu_n C_{ox} \frac{W}{L} \left( \left(V_{GS} - V_{TH,n}\right) V_{DS} - \frac{V_{DS}^2}{2}  \right)
		\end{equation}
	}

	{	Obszar nasycenia tranzystora NFET:
		\begin{equation}
			V_{GS} > V_{TH,n}
		\end{equation}
		
		\begin{equation}
			V_{DS} > V_{GS} - V_{TH,n}
		\end{equation}
		
		\begin{equation}
			I_{DS} = \frac{1}{2} \mu_n C_{ox} \frac{W}{L} \left( V_{GS} - V_{TH,n} \right)^2
		\end{equation}	
	}

	{	Obszar odcięcia tranzystora PFET:
		\begin{equation}
		V_{SG} \leq \left|V_{TH,p}\right|
		\end{equation}
		
		\begin{equation}
		I_{SD} \eqsim 0
		\end{equation}
	}
	
	{	Obszar nienasycenia tranzystora PFET:
		\begin{equation}
		V_{SG} > \left|V_{TH,p}\right|
		\end{equation}
		
		\begin{equation}
		V_{SD} \leq V_{SG} - \left|V_{TH,p}\right|
		\end{equation}
		
		\begin{equation}
		I_{DS} = \mu_p C_{ox} \frac{W}{L} \left( \left(V_{SG} - \left|V_{TH,p}\right| \right) V_{SD} - \frac{V_{SD}^2}{2}  \right)
		\end{equation}
	}
	
	{	Obszar nasycenia tranzystora PFET:
		\begin{equation}
		V_{SG} > \left|V_{TH,p}\right|
		\end{equation}
		
		\begin{equation}
		V_{SD} > V_{SG} - \left|V_{TH,p}\right|
		\end{equation}
		
		\begin{equation}
		I_{DS} = \frac{1}{2} \mu_p C_{ox} \frac{W}{L} \left( V_{SG} - \left|V_{TH,p}\right| \right)^2
		\end{equation}	
	}

	{	Ponadto wprowadzono oznaczenia:
	
		$$
			K_i = \mu_i C_{ox}
		$$
	
		$$
			\beta_i = \mu_i C_{ox} \frac{W}{L} = K_i \frac{W}{L}
		$$
	}

	{	Z dokumentacji wyciągnięto następujące wartości stałych procesu:
		$$
			V_{TH,n} = 0.355V
		$$
		
		$$
			K_n = 274 \frac{\mu A}{V^2}
		$$

		$$
			V_{TH,p} = -0.405V
		$$
	
		$$
			K_p = 56 \frac{\mu A}{V^2}
		$$	
	}
	\section{Zakres temperatur.}
	{	Proces został zakwalifikowany do zakresu temperatur złącza $-40^\circ C \leq T \leq 150^\circ C$. }


	
	\chapter{Zaprojektowany konwerter.}
	\section{Metodologia projektowania.}
	{	Projekt układu scalonego rozpoczyna się od sformułowania wymagań (specyfikacji) urządzenia lub systemu. W temacie niniejszej pracy 	sformułowano następujące wymagania na przetwornik:
		\begin{itemize}
			\item zasilany ze źródła napięcia stałego o wartości 1.8V,
			\item zaprojektowany w technologii CMOS AMS 180nm,
			\item osiąga szybkość konwersji powyżej 4 milionów próbek na sekundę (MSPS),
			\item ma 8-bitów rozdzielczości.
		\end{itemize} 
	Ponadto, projektant doprecyzował następujące parametry:
		\begin{itemize}
			\item sygnał wyjściowy to sygnał napięciowy o zakresie co najmniej od 0V do 1V,
			\item dopuszczalne obciążenie ma charakter rezystancyjny o minimalnej wartości $50\Omega$.
		\end{itemize} }
	
	{	Na podstawie wymagań należy zaproponować architekturę urządzenia na podstawie analizy obecnego stanu wiedzy technicznej lub przeprowadzić zgrubne (często ręczne) obliczenia, potwierdzające spełnienie wymagań. Po zapoznaniu się z literaturą wybór padł na konwerter skalujący prąd. Najistotniejsze motywacje tego wyboru to prostota schematu, wysoka szybkość działania \cite{cmosanal} oraz fakt, że poprzednie prace uzyskały do 10 bitów rozdzielczości \cite{plassche}.	Autorzy \cite{cmosanal} jako główne wady podają duży rozmiar oraz duży rozstęp wielkości elementów.}
	
	{	Blokowy schemat konwertera skalującego prąd znajduje sie na rysunku \ref{currentscale}. \textcolor{red}{Na rysunku są 4 prądy, można uogólnić ten obrazek lub dostosować do 8-bit?} Zasada działania jest następująca: słowo cyfrowe jest sygnałem sterującym sieć, która może wytwarzać prądy o różnych wartościach. Typowo, przypisuje sie prądom wagi dwójkowe, a kolejne bity słowa cyfrowego decydują o włączeniu/wyłączeniu gałęzi prądowej, co oznacza, że po zsumowaniu prądów wyjściowych otrzymujemy prąd o wartości  bezwzględnej równej wartości zakodowanej w słowie cyfrowym. W zależności od wymagań na sygnał wyjściowy, dokonuje się konwersji prądu wyjściowego na napięcie. 
	
		\img{20}{../visio/currentscale.pdf}{Schemat blokowy konwertera skalującego prąd}{currentscale}	}

	\begin{tikzpicture}[auto]
	\node [block] (network) {Sieć skalująca prąd};
 	\draw[<-] ([xshift=0pt,yshift=0pt]network.west)  -- node[above, xshift=-40pt]{n-bitowe słowo cyfrowe} ++(-4em,0em);
 	\draw[<-] ([yshift=0pt]network.north)  -- node[left]{Napięcie referencyjne} ++(0em,+4em);
		%\draw ;
	\end{tikzpicture}

	{	Typową praktyką jest doposażenie konwertera w rejestr wejściowy, aby ułatwić integrację przetwornika z innymi, cyfrowymi blokami systemu. W przypadku projektowania przetworników, które samodzielnie tworzą układ scalony umieszcza się także standardowe interfejsy cyfrowe, np. SPI lub I2C. Ponadto, na rynku dostępne są konwertery wyposażone w rejestr kontrolny, który umożliwia wykorzystanie dodatkowych funkcjonalności np. programowania wzmocnienia sygnału wyjściowego, autotestowania lub autokalibracji.
		\img{20}{../visio/blokschkonca.pdf}{Blokowy schemat konwertera C/A.}{blokschkonca} }

	{	Poprawnie zaprojektowane układy scalone charakteryzują się niewrażliwością na 3 istotne czynniki:
		\begin{itemize}
			\item rozrzut technologiczny (precyzja wykonania, niedopasowanie) parametrów elementów elektronicznych,
			\item zmiana temperatury,
			\item odchyłki napięcia zasilania od wartości nominalnej.
		\end{itemize}
		Wszystkie wymienione tu czynniki zostały zaadresowane w niniejszej pracy. }
	

	\chapter{Schemat elektryczny.}
	\section{Układ bandgap.}
	{	Kluczowym dla poprawnego działania konwertera skalowanego jest stabilne źródło napięcia odniesienia. Układy wytwarzane w technologii CMOS są wrażliwe na rorzut technologiczny parametrów elementów elektronicznych, zmieniają się ich właściwości pod wpływem zmian temperatury lub zmian wartości napięcia zasilania. Aby zapewnić stabilność napięcia odniesienia stosuje się układ bandgap. }
	
	{ 	Na podstawie literatury w tej technologii można uzyskać źródła napięcia odniesienia niezależne od temperatury o wartości około $V_{REF}=1.1V$. Taką wartość napięcia referencyjnego przyjmiemy dla pozostałych bloków. }
	
	\section{Sieć ważonych prądów.}
	
	{ Ogólny schemat sieci ważonych prądów został zaczerpnięty z \cite{cmosanal}. Ponizej dokonano szczegółowej analizy. Należy zauważyć, że napięcie potencjał źródeł tranzystorów w lustrach prądowych jest ujemne na schemacie w \cite{cmosanal}. Do aplikacji opsianej w tej pracy należy zmodyfikować schemat... Napięcia referencyjne ustalimy na $ \frac{1}{2}V_{REF}$.
	
	\begin{circuitikz}
		\draw [color=black, thick]
		%Ground
		(0,0) node[circ]{}
		(0,0) node[ground]{} 
		(0,6) node[]{\large{\textbf{$V_{ref}$}}}
		(0,1) node[nmos, rotate =180, label={ [centered,xshift=-10, yshift = 10] {$M_0$} } ](m0){}
		(0,5.5) to[short,o-] (m0.S)
		(0,0) to[short] (m0.D)
		%Ground line
		(0,0) to[short,-] (16,0)
		(m0.G) to[short] (15,1)
		%Vref label
		(10,6) node[]{\large{\textbf{$V_{ref}$}}}
		;
		\foreach \x in {1,...,8}
		{
			\pgfmathsetmacro{\offsetx}{int(2*\x)};
			\draw [color=black, thick]
			(\offsetx,1) node[nmos, label={ [centered,xshift=10, yshift = 10] {$M_\x$} } ](m\x){}
			(\offsetx,0) to[short,*-] (m\x.S)
			(\offsetx,3) node[nmos, label={ [centered,xshift=10, yshift = 10] {$K_\x$} } ](k\x){}
			(\offsetx-1,3) to[short,o-] (k\x.G)
			(m\x.D) to[short] (k\x.S)
			;
		}
		\foreach \x in {1,...,7}
		{
			\pgfmathsetmacro{\incx}{int(\x+1)};
			\draw (k\x.D) to[short,*-*] (k\incx.D);
		}
		\draw
		(k5.D) to[short,*-o] (10,5.5)
		;
	\end{circuitikz}
	}

	\subsection{Konwersja prądu na napięcie przy pomocy pojedynczego tranzystora.}
	{	Tranzystor MOSFET połączony jak na \ref{itov} może być traktowany jako przetwornik prądu na napięcie. 
	}

	\begin{figure}[h!]
	\begin{center}
		\begin{circuitikz}
			\draw [color=black, thick]
			%Ground
			(0,0) node[ground]{} 
			(0,0) to [I=${I_{ref}}$] (0,2)
			(2,0) node[ground]{} 
			(2,1) node[nmos, rotate =180, label={ [centered,xshift=-10, yshift = 10] {$M_0$} } ](m0){}
			(0,2) to[short] (2,2)
			(2,0) to[short] (m0.D)
			(2,2) to[] (m0.S)
			(2,2) to[short,*-] (3,2)
			(3,2) to[short,-*] (3,1)
			%Ground line
			(m0.G) to[short,-o] (4,1)
			(4.5,1) node[]{\large{\textbf{$V_{out}$}}}
			;
		\end{circuitikz}
		\caption{Konwersja prądu na napięcie.}
		\label{itov}
	\end{center}	
	\end{figure}

	
	{	Zakładając, że tranzystor pracuje w obszarze aktywnym, prąd drenu jest równy:
		\begin{equation}
		I_{REF} = K' \frac{W}{L}\left( V_{GS}-V_{TH,n}\right)^2
		\end{equation}
	Zaniedbując efekt modulacji kanału i uwzględniając, że źródło tranzystora jest na poziomie masy sygnałowej, napięcie wyjściowy może zostać wyliczone jako:
		\begin{equation} \label{eq_v_out_mosfet}
		V_{OUT} = V_{D} = V_{G} = \sqrt{\frac{I_{REF}}{K'}\frac{L}{W}} + V_{TH,n}
		\end{equation}
	}

	\subsection{Konwersja prądu na napięcie przy pomocy tranzystora i wzmacniacza operacyjnego.}
		\begin{center}
		\begin{circuitikz}
			\draw [color=black, thick]
			%Ground
			
			(0, 1) node[op amp, rotate =270] (opamp) {$A_1$}
			(opamp.+) node[ground, rotate = 180] {}
			
			(opamp.-) to [short] (0.5,2.5)
			(2,5) to [I=${I_{ref}}$] (2,3)
			(2,5) node[ground, rotate = 180 ]{}
			(2,1) node[nmos, rotate =180, label={ [centered,xshift=-10, yshift = 10] {$M_0$} } ](m0){}
			(0.5,2.5) to[short] (2,2.5)
			(2,0) to[short] (m0.D)
			(opamp.out) to [short](0,-0.5)
			(2,3) to [] (m0.S)
			(0,-0.5) to [short] (2,-0.5)
			(m0.D) to [] (2,-0.5)
			(2,2) to[] (m0.S)
			(2,2.5) to[short,*-] (3,2.5)
			(3,2.5) to[short,-*] (3,1)
			%Ground line
			(m0.G) to[short,-o] (4,1)
			(4.5,1) node[]{\large{\textbf{$V_{out}$}}}
			;
		\end{circuitikz}
	
	{ Wzmacniacz operacyjny w pętli sprzężenia zwrotnego wymusi potencjał masy na wejściu minus. Biorąc dane z modelu do obliczeń ręcznych i dla rysunku powyżej, z \ref{eq_cutoff} otrzymujemy nierówność:
		$$
		0 - V_s > V_{th,n} = 0.4
		$$
		Źródło prądowe wymusza prąd $I_{ref}$, więc:
		$$
		I_{ref} = K \frac{W}{L}\left( V_s-V_{th,n}\right)^2
		$$
		Zakładając jednostkowy stosunek szerkości do wyskości i podstawiając dane otrzymujemy dla $I_{ref} = 10\mu A$:
		$$
		V_s = -0.839V
		$$
	}
	\end{center}

	\subsection{Analiza lustra prądowego z kluczem z pojedynczego nMOSFET.}
	{ Projektując lustro prądowe, należy zadbać, aby tranzystory były w obszarze aktywnym, czyli:
		\begin{equation} \label{eq_cutoff}
		V_{gs} > V_{th,n}
		\end{equation}
		oraz
		\begin{equation} \label{eq_saturation}
		V_{ds} \ge V_{gs} - V_{th,n}
		\end{equation}
		Ze względu na połączenie drenu i bramki \ref{eq_saturation} jest zawsze prawdą.
	}
	\subsection{Dobór długości kanału na podstawie charakterystyk niedopasowania.}
	{	Producent technologii dostarcza wzory opisujące odchylenie standardowe parametrów urządzeń, które zostały zaprojektowane jako identyczne. Do generacji prądów o binarnych wagach wykorzystujemy lustra prądowe, składające się z kolejno $1, 2, 4,..., 2^{N-1}$. Błąd napięciowego sygnału wyjściowego musi być mniejszy niż $\frac{LSB}{2}$. Zakładając, że napięciowy sygnał wejściowy jest proporcjonalny do sumy tych prądów:
		\begin{equation}
		V_{out} = A \sum_{i=0}^{N-1} b_{i}I_{i}
		\end{equation}
	LSB dla konwertera wynosi, gdzie FS oznacza pełen zakres sygnału wyjściowego:
		\begin{equation}
			LSB_v = \frac{FS_Vout}{2^{N-1}}
		\end{equation}
	Dla prądów:
		\begin{equation}
			LSB_i = \frac{LSB_v}{A}
		\end{equation}

	W związku z tym faktem zakłada się, że błąd każdego z prądów również musi być mniejszy od $\frac{LSB}{2}$. Prąd i-tej gałęzi jest sumą $2^{i}$ prądów, przepływających przez $2^{i}$ identycznych tranzystorów. Aby błąd sumarycznego prądu każdej gałęzi był mniejszy niż LSB/2, suma błędów niedopasowania wszystkich tranzystorów w każdej gałęzi musi być mniejsza niż LSB/2. 
		\begin{equation}
			\sigma \left( \Delta I_{i,ds} \right) < \frac{LSB_i}{2}
		\end{equation}
	Łatwo zauważyć, że największy błąd jest dla ostatniej gałęzi z największą liczbą tranzystorów: $n=2^{N-1}=2^7$. Minimalny prąd referencyjny w pierwszej gałęzi ma wartość LSB.
		\begin{equation}
		n \sigma \left( \Delta I_{N-1,ds} \right) LSB_i = 2^{N-1} \sigma \left( \Delta I_{N-1,ds} \right) LSB_i < \frac{LSB_i}{2}
		\end{equation}

		\begin{equation}
			\sigma \left( \Delta I_{N-1,ds} \right) < 2^{-N}
		\end{equation}

	Z cite{AMSmatching} mamy:
		\begin{equation}
			\sigma^2 \left( \frac{\Delta I_{ds}}{I_{ds}}\right) = 	\sigma^2 \left( \frac{\Delta \mu}{\mu}\right) + \sigma^2 \left( \frac{2\Delta V_T}{V_{gs} - V_{T}}\right)
		\end{equation}
		
		\begin{equation}
			3 \sigma \left(\Delta \mu \right) = \frac{ \sqrt{2} A_{\beta}  } { \sqrt{ \left(W-A_{\beta W}\right)\left(L-A_{\beta} L\right)}}
		\end{equation}

		\begin{equation}
		3 \sigma \left(\Delta V_T \right) = \frac{ \sqrt{2} A_{V_T}  } { \sqrt{ \left(W-A_{VTW}\right)\left(L-A_{VTL}\right)}}
		\end{equation}
	Wykreślmy błąd prądu przy pomocy Octave, znajdziemy minimalne L.
		
	}
	



	\subsection{Źródło napięcia referencyjnego zbudowane z dwóch tranzystorów.}
	obwód generacji napięcia odniesienia jak z rysunku...
	Ze względu na połączenie drenu i bramki, tranzystor może pracować tylko w nasyceniu lub odcięciu. Zakładając, że oba tranzystory
	są w nasyceniu i oznaczając napięcie drenu jako $V_{out}$ układamy równania dla nMOSFET:
	\begin{equation}
	V_{out} > V_{th,n}
	\end{equation}
	
	\begin{equation}
	V_{out} > V_{out} - V_{th,n}
	\end{equation}
	
	i pMOSFET:
	
	\begin{equation}
	V_{dd} - V_{out} > \left|V_{th,p}\right|
	\end{equation}
	
	\begin{equation}
	V_{dd} - V_{out} > V_{dd} - V_{out} - \left|V_{th,p}\right|
	\end{equation}
	
	Po prostych przekształceniach:
	\begin{equation}
	V_{out} > V_{th,n}
	\end{equation}
	
	\begin{equation}
	0 > - V_{th,n}
	\end{equation}
	
	i pMOSFET:
	
	\begin{equation}
	V_{dd} - V_{out} > \left|V_{th,p}\right|
	\end{equation}
	
	\begin{equation}
	0 > - \left|V_{th,p}\right|
	\end{equation}
	
	
	Ponadto, prądy muszą być równe:
	\begin{equation}
	I_{d,n} = I_{d,p}
	\end{equation}
	
	W nasyceniu:
	\begin{equation}
	\beta_n \left(V_{out} - V_{th,n}\right)^2 = \beta_p \left(V_{dd} - V_{out} - \left|V_{th,p}\right|\right)^2
	\end{equation}
	Obie strony są zawsze dodatnie, więc możemy pierwiastkować:
	\begin{equation}
	\left(V_{out} - V_{th,n}\right) = \sqrt{\frac{\beta_p}{\beta_n}}\left(V_{dd} - V_{out} - \left|V_{th,p}\right|\right)
	\end{equation}
	
	\begin{equation}
	V_{out}\left(1+\sqrt{\frac{\beta_p}{\beta_n}}\right) = \sqrt{\frac{\beta_p}{\beta_n}}\left(V_{dd} -\left|V_{th,p}\right|\right)+V_{th,n}
	\end{equation}
	
	\begin{equation}
	V_{out} =\frac{\sqrt{\frac{\beta_p}{\beta_n}}\left(V_{dd} -\left|V_{th,p}\right|\right)+V_{th,n}}{\left(1+\sqrt{\frac{\beta_p}{\beta_n}}\right)}
	\end{equation}	
	
	Zauważmy, że dla procesu o równych napięciach progowych i tranzystorów o tej samej $\beta$, wynik jest dość intuicyjny:
	\begin{equation}
	V_{out} =\frac{1}{2} V_{dd}
	\end{equation}
	
	\section{Wyjściowy wzmacniacz transkonduktancyjny.}


	\begin{circuitikz}
		\draw [color=black, thick]
			(0, 0) node[op amp] (opamp) {}
			(opamp.-) to[R] (-3, 0.5)
			(opamp.-) to[short,*-] ++(0,1.5) coordinate (leftR)
			to[R] (leftR -| opamp.out)
			to[short,-*] (opamp.out)
			;
	\end{circuitikz}

	\chapter{Symulacje i pomiary parametrów.}
	\section{Układ testujący do wyznaczenia x.}
	\section{Układ testujący do wyznaczenia y.}
	\section{Układ testujący do wyznaczenia z.}
	
	\chapter{Projekt fizyczny.}
	\section{Hierarchizacja projektu.}
	\section{Widok topografii układu bandgap.}
	\section{Widok topografii układu 2.}
	\section{Widok topografii układu 3.}
	\section{Widok topografii układu 4.}
	
	\chapter{Symulacje i pomiary po ekstrakcji.}
	
	\chapter{Podsumowanie.}
	\section{Rozmiar układu, liczba tranzystorów.}
	\section{Weryfikacja osiągniętych celów.}
	\section{Wnioski końcowe.}	

	
	\appendix
	%insert chapters	
.
	\begin{thebibliography}{9}
		%%moje z knovela
		\bibitem{integconv} 
		Jespers, Paul G.A.. (2001). 
		\textit{Integrated Converters - D to A and A to D Architectures, Analysis and Simulation.}
		Oxford University Press
		
		\bibitem{cmosanal} 
		Allen, Phillip E. Holberg, Douglas R.. (2012)  
		\textit{CMOS Analog Circuit Design (3rd Edition). }
		Oxford University Press.
		
		\bibitem{vlsidesign} 
		Das, Debaprasad. (2015).
		\textit{VLSI Design (2nd edition)}
		Oxford University Press.
		%%z opisu tematu od profa allen cmos sie pokrywa z moim wyborem
		\bibitem{plassche} 
		R. Plassche (2001). 
		\textit{Scalone przetworniki analogowo-cyfrowe i cyfrowo-analogowe,}
		WKŁ 2001
		
		\bibitem{bdgp_1}
		Design of an improved Bandgap Reference in
		180nm CMOS Process Technology

		\bibitem{bdgp_2}
		Design and implementation of curvature corrected
		bandgap voltage reference - 1.1V using 180nm Technology

		\bibitem{ams_proc_params}
		$0.18\mu m$ HV CMOS Process Parameters, Rev. 3.0, AMS AG

		\bibitem{ams_match_params}
		$0.18\mu m$ HV CMOS Matching Parameters, Rev. 1.0, AMS AG
		
	\end{thebibliography}

\end{document}
